2025-03-08 16:10:17.645 |  ERROR   | process [7604]:8598504000 | 无UUID | uvicorn.protocols.http.httptools_impl:run_asgi:414 - Exception in ASGI application

Traceback (most recent call last):

  File "/Users/shareai-lm/lm-codespace/server/fastapi_template/lib/python3.10/site-packages/fastapi/encoders.py", line 324, in jsonable_encoder
    data = dict(obj)
                └ <async_generator object chat_stream.<locals>.event_generator at 0x10b4ff9c0>

TypeError: 'async_generator' object is not iterable


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/Users/shareai-lm/lm-codespace/server/fastapi_template/lib/python3.10/site-packages/fastapi/encoders.py", line 329, in jsonable_encoder
    data = vars(obj)
                └ <async_generator object chat_stream.<locals>.event_generator at 0x10b4ff9c0>

TypeError: vars() argument must have __dict__ attribute


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/Users/shareai-lm/lm-codespace/server/fastapi_template/lib/python3.10/site-packages/starlette/middleware/errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x10b464430>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x10b4526...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x10b4195a0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x10b419510>
  File "/Users/shareai-lm/lm-codespace/server/fastapi_template/lib/python3.10/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
          │                            │    │    │     │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x10b464430>
          │                            │    │    │     │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x10b4526...
          │                            │    │    │     └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │                            │    │    └ <starlette.requests.Request object at 0x10b452f50>
          │                            │    └ <fastapi.routing.APIRouter object at 0x10a1fa260>
          │                            └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x10b4195a0>
          └ <function wrap_app_handling_exceptions at 0x10a132a70>
  File "/Users/shareai-lm/lm-codespace/server/fastapi_template/lib/python3.10/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/shareai-lm/lm-codespace/server/fastapi_template/lib/python3.10/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
          │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x10b4645e0>
          │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x10b4526...
          │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          └ <fastapi.routing.APIRouter object at 0x10a1fa260>
  File "/Users/shareai-lm/lm-codespace/server/fastapi_template/lib/python3.10/site-packages/starlette/routing.py", line 715, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x10b4645e0>
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x10b4526...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <bound method Router.app of <fastapi.routing.APIRouter object at 0x10a1fa260>>
          └ <fastapi.routing.APIRouter object at 0x10a1fa260>
  File "/Users/shareai-lm/lm-codespace/server/fastapi_template/lib/python3.10/site-packages/starlette/routing.py", line 735, in app
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x10b4645e0>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x10b4526...
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x10a133f40>
          └ APIRoute(path='/chat/stream', name='chat_stream', methods=['POST'])
  File "/Users/shareai-lm/lm-codespace/server/fastapi_template/lib/python3.10/site-packages/starlette/routing.py", line 288, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x10b4645e0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x10b4526...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x10b40c8b0>
          └ APIRoute(path='/chat/stream', name='chat_stream', methods=['POST'])
  File "/Users/shareai-lm/lm-codespace/server/fastapi_template/lib/python3.10/site-packages/starlette/routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
          │                            │    │        │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x10b4645e0>
          │                            │    │        │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x10b4526...
          │                            │    │        └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │                            │    └ <starlette.requests.Request object at 0x10b453e20>
          │                            └ <function request_response.<locals>.app.<locals>.app at 0x10b467b50>
          └ <function wrap_app_handling_exceptions at 0x10a132a70>
  File "/Users/shareai-lm/lm-codespace/server/fastapi_template/lib/python3.10/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/shareai-lm/lm-codespace/server/fastapi_template/lib/python3.10/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
          │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x10b464550>
          │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x10b4526...
          │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          └ <function request_response.<locals>.app.<locals>.app at 0x10b467b50>
  File "/Users/shareai-lm/lm-codespace/server/fastapi_template/lib/python3.10/site-packages/starlette/routing.py", line 73, in app
    response = await f(request)
                     │ └ <starlette.requests.Request object at 0x10b453e20>
                     └ <function get_request_handler.<locals>.app at 0x10b40c820>
  File "/Users/shareai-lm/lm-codespace/server/fastapi_template/lib/python3.10/site-packages/fastapi/routing.py", line 327, in app
    content = await serialize_response(
                    └ <function serialize_response at 0x10a160e50>
  File "/Users/shareai-lm/lm-codespace/server/fastapi_template/lib/python3.10/site-packages/fastapi/routing.py", line 201, in serialize_response
    return jsonable_encoder(response_content)
           │                └ <async_generator object chat_stream.<locals>.event_generator at 0x10b4ff9c0>
           └ <function jsonable_encoder at 0x10a132200>
  File "/Users/shareai-lm/lm-codespace/server/fastapi_template/lib/python3.10/site-packages/fastapi/encoders.py", line 332, in jsonable_encoder
    raise ValueError(errors) from e
                     └ [TypeError("'async_generator' object is not iterable"), TypeError('vars() argument must have __dict__ attribute')]

ValueError: [TypeError("'async_generator' object is not iterable"), TypeError('vars() argument must have __dict__ attribute')]


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/Users/shareai-lm/.local/share/uv/python/cpython-3.10.16-macos-aarch64-none/lib/python3.10/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x10531a200>
  File "/Users/shareai-lm/.local/share/uv/python/cpython-3.10.16-macos-aarch64-none/lib/python3.10/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x1050fd2d0>
           └ <SpawnProcess name='SpawnProcess-2' parent=7490 started>
  File "/Users/shareai-lm/.local/share/uv/python/cpython-3.10.16-macos-aarch64-none/lib/python3.10/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x1050fc940>
    └ <SpawnProcess name='SpawnProcess-2' parent=7490 started>
  File "/Users/shareai-lm/.local/share/uv/python/cpython-3.10.16-macos-aarch64-none/lib/python3.10/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x105335d50>, 'target': <bound method Server.run of <uvicorn.server.Server object...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-2' parent=7490 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-2' parent=7490 started>
    │    └ <function subprocess_started at 0x108039cf0>
    └ <SpawnProcess name='SpawnProcess-2' parent=7490 started>
  File "/Users/shareai-lm/lm-codespace/server/fastapi_template/lib/python3.10/site-packages/uvicorn/_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('0.0.0.0', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x105335de0>>
  File "/Users/shareai-lm/lm-codespace/server/fastapi_template/lib/python3.10/site-packages/uvicorn/server.py", line 66, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('0.0.0.0', 8000)>]
           │       │   │    └ <function Server.serve at 0x108039090>
           │       │   └ <uvicorn.server.Server object at 0x105335de0>
           │       └ <function run at 0x105321480>
           └ <module 'asyncio' from '/Users/shareai-lm/.local/share/uv/python/cpython-3.10.16-macos-aarch64-none/lib/python3.10/asyncio/__...
  File "/Users/shareai-lm/.local/share/uv/python/cpython-3.10.16-macos-aarch64-none/lib/python3.10/asyncio/runners.py", line 44, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x108bc3ae0>
           │    └ <cyfunction Loop.run_until_complete at 0x108e886c0>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/Users/shareai-lm/lm-codespace/server/fastapi_template/lib/python3.10/site-packages/uvicorn/protocols/http/httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x108ee5d50>
  File "/Users/shareai-lm/lm-codespace/server/fastapi_template/lib/python3.10/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x10b452650>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x10b4526...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x108d799f0>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x108ee5d50>
  File "/Users/shareai-lm/lm-codespace/server/fastapi_template/lib/python3.10/site-packages/fastapi/applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x10b452650>>
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x10b4526...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "/Users/shareai-lm/lm-codespace/server/fastapi_template/lib/python3.10/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x10b452650>>
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x10b4526...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x10b419510>
          └ <fastapi.applications.FastAPI object at 0x108d799f0>
  File "/Users/shareai-lm/lm-codespace/server/fastapi_template/lib/python3.10/site-packages/starlette/middleware/errors.py", line 177, in __call__
    response = await self.handler(request, exc)
                     │    │       └ <starlette.requests.Request object at 0x10b452500>
                     │    └ <function handle_general_exception at 0x10a1f5510>
                     └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x10b419510>

  File "/Users/shareai-lm/lm-codespace/server/app/middreware/exception_handler.py", line 33, in handle_general_exception
    return error_response(
           └ functools.partial(<function create_response at 0x10a1f5090>, data=None)

TypeError: create_response() got an unexpected keyword argument 'message'
2025-03-08 17:03:38.656 |  ERROR   | process [19312]:8598504000 | 无UUID | uvicorn.protocols.http.httptools_impl:run_asgi:414 - Exception in ASGI application

Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/Users/shareai-lm/.local/share/uv/python/cpython-3.10.16-macos-aarch64-none/lib/python3.10/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x102e32200>
  File "/Users/shareai-lm/.local/share/uv/python/cpython-3.10.16-macos-aarch64-none/lib/python3.10/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x102d4d2d0>
           └ <SpawnProcess name='SpawnProcess-53' parent=7490 started>
  File "/Users/shareai-lm/.local/share/uv/python/cpython-3.10.16-macos-aarch64-none/lib/python3.10/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x102d4c940>
    └ <SpawnProcess name='SpawnProcess-53' parent=7490 started>
  File "/Users/shareai-lm/.local/share/uv/python/cpython-3.10.16-macos-aarch64-none/lib/python3.10/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x102e4dd50>, 'target': <bound method Server.run of <uvicorn.server.Server object...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-53' parent=7490 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-53' parent=7490 started>
    │    └ <function subprocess_started at 0x103351cf0>
    └ <SpawnProcess name='SpawnProcess-53' parent=7490 started>
  File "/Users/shareai-lm/lm-codespace/server/fastapi_template/lib/python3.10/site-packages/uvicorn/_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('0.0.0.0', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x102e4dde0>>
  File "/Users/shareai-lm/lm-codespace/server/fastapi_template/lib/python3.10/site-packages/uvicorn/server.py", line 66, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('0.0.0.0', 8000)>]
           │       │   │    └ <function Server.serve at 0x103351090>
           │       │   └ <uvicorn.server.Server object at 0x102e4dde0>
           │       └ <function run at 0x102e39480>
           └ <module 'asyncio' from '/Users/shareai-lm/.local/share/uv/python/cpython-3.10.16-macos-aarch64-none/lib/python3.10/asyncio/__...
  File "/Users/shareai-lm/.local/share/uv/python/cpython-3.10.16-macos-aarch64-none/lib/python3.10/asyncio/runners.py", line 44, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x104a4bb50>
           │    └ <cyfunction Loop.run_until_complete at 0x1051b46c0>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/Users/shareai-lm/lm-codespace/server/fastapi_template/lib/python3.10/site-packages/uvicorn/protocols/http/httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x1051be2f0>
  File "/Users/shareai-lm/lm-codespace/server/fastapi_template/lib/python3.10/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x1077527a0>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x1077527...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x104c099c0>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x1051be2f0>
  File "/Users/shareai-lm/lm-codespace/server/fastapi_template/lib/python3.10/site-packages/fastapi/applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x1077527a0>>
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x1077527...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "/Users/shareai-lm/lm-codespace/server/fastapi_template/lib/python3.10/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x1077527a0>>
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x1077527...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x10771a410>
          └ <fastapi.applications.FastAPI object at 0x104c099c0>
  File "/Users/shareai-lm/lm-codespace/server/fastapi_template/lib/python3.10/site-packages/starlette/middleware/errors.py", line 187, in __call__
    raise exc
  File "/Users/shareai-lm/lm-codespace/server/fastapi_template/lib/python3.10/site-packages/starlette/middleware/errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x1077645e0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x1077527...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x10771a470>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x10771a410>
  File "/Users/shareai-lm/lm-codespace/server/fastapi_template/lib/python3.10/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
          │                            │    │    │     │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x1077645e0>
          │                            │    │    │     │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x1077527...
          │                            │    │    │     └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │                            │    │    └ <starlette.requests.Request object at 0x107752860>
          │                            │    └ <fastapi.routing.APIRouter object at 0x1064abd90>
          │                            └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x10771a470>
          └ <function wrap_app_handling_exceptions at 0x106332a70>
  File "/Users/shareai-lm/lm-codespace/server/fastapi_template/lib/python3.10/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/shareai-lm/lm-codespace/server/fastapi_template/lib/python3.10/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
          │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x107764550>
          │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x1077527...
          │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          └ <fastapi.routing.APIRouter object at 0x1064abd90>
  File "/Users/shareai-lm/lm-codespace/server/fastapi_template/lib/python3.10/site-packages/starlette/routing.py", line 715, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x107764550>
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x1077527...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <bound method Router.app of <fastapi.routing.APIRouter object at 0x1064abd90>>
          └ <fastapi.routing.APIRouter object at 0x1064abd90>
  File "/Users/shareai-lm/lm-codespace/server/fastapi_template/lib/python3.10/site-packages/starlette/routing.py", line 735, in app
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x107764550>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x1077527...
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x106333f40>
          └ APIRoute(path='/chat/completions', name='chat_completions', methods=['POST'])
  File "/Users/shareai-lm/lm-codespace/server/fastapi_template/lib/python3.10/site-packages/starlette/routing.py", line 288, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x107764550>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x1077527...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x10770c550>
          └ APIRoute(path='/chat/completions', name='chat_completions', methods=['POST'])
  File "/Users/shareai-lm/lm-codespace/server/fastapi_template/lib/python3.10/site-packages/starlette/routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
          │                            │    │        │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x107764550>
          │                            │    │        │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x1077527...
          │                            │    │        └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │                            │    └ <starlette.requests.Request object at 0x1077529e0>
          │                            └ <function request_response.<locals>.app.<locals>.app at 0x1077644c0>
          └ <function wrap_app_handling_exceptions at 0x106332a70>
  File "/Users/shareai-lm/lm-codespace/server/fastapi_template/lib/python3.10/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/shareai-lm/lm-codespace/server/fastapi_template/lib/python3.10/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
          │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x107764430>
          │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x1077527...
          │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          └ <function request_response.<locals>.app.<locals>.app at 0x1077644c0>
  File "/Users/shareai-lm/lm-codespace/server/fastapi_template/lib/python3.10/site-packages/starlette/routing.py", line 73, in app
    response = await f(request)
                     │ └ <starlette.requests.Request object at 0x1077529e0>
                     └ <function get_request_handler.<locals>.app at 0x10770c4c0>
  File "/Users/shareai-lm/lm-codespace/server/fastapi_template/lib/python3.10/site-packages/fastapi/routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x106361ab0>
  File "/Users/shareai-lm/lm-codespace/server/fastapi_template/lib/python3.10/site-packages/fastapi/routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'request': ChatRequest(messages=[], prompt='哈哈哈', system_prompt=None, model='gpt-4o-mini', stream=True, max_retries=2, retry...
                 │         └ <function chat_completions at 0x1074c2a70>
                 └ Dependant(path_params=[], query_params=[], header_params=[], cookie_params=[], body_params=[ModelField(field_info=Body(Pydant...

  File "/Users/shareai-lm/lm-codespace/server/app/controller/chat.py", line 44, in chat_completions
    raise error_response(data=None, msg=f"服务器繁忙")
          └ functools.partial(<function create_response at 0x1063f5090>, data=None)

TypeError: create_response() missing 1 required keyword-only argument: 'code'
2025-03-08 17:03:46.736 |  ERROR   | process [19312]:8598504000 | 无UUID | uvicorn.protocols.http.httptools_impl:run_asgi:414 - Exception in ASGI application

Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/Users/shareai-lm/.local/share/uv/python/cpython-3.10.16-macos-aarch64-none/lib/python3.10/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x102e32200>
  File "/Users/shareai-lm/.local/share/uv/python/cpython-3.10.16-macos-aarch64-none/lib/python3.10/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x102d4d2d0>
           └ <SpawnProcess name='SpawnProcess-53' parent=7490 started>
  File "/Users/shareai-lm/.local/share/uv/python/cpython-3.10.16-macos-aarch64-none/lib/python3.10/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x102d4c940>
    └ <SpawnProcess name='SpawnProcess-53' parent=7490 started>
  File "/Users/shareai-lm/.local/share/uv/python/cpython-3.10.16-macos-aarch64-none/lib/python3.10/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x102e4dd50>, 'target': <bound method Server.run of <uvicorn.server.Server object...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-53' parent=7490 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-53' parent=7490 started>
    │    └ <function subprocess_started at 0x103351cf0>
    └ <SpawnProcess name='SpawnProcess-53' parent=7490 started>
  File "/Users/shareai-lm/lm-codespace/server/fastapi_template/lib/python3.10/site-packages/uvicorn/_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('0.0.0.0', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x102e4dde0>>
  File "/Users/shareai-lm/lm-codespace/server/fastapi_template/lib/python3.10/site-packages/uvicorn/server.py", line 66, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('0.0.0.0', 8000)>]
           │       │   │    └ <function Server.serve at 0x103351090>
           │       │   └ <uvicorn.server.Server object at 0x102e4dde0>
           │       └ <function run at 0x102e39480>
           └ <module 'asyncio' from '/Users/shareai-lm/.local/share/uv/python/cpython-3.10.16-macos-aarch64-none/lib/python3.10/asyncio/__...
  File "/Users/shareai-lm/.local/share/uv/python/cpython-3.10.16-macos-aarch64-none/lib/python3.10/asyncio/runners.py", line 44, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x104a4bb50>
           │    └ <cyfunction Loop.run_until_complete at 0x1051b46c0>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/Users/shareai-lm/lm-codespace/server/fastapi_template/lib/python3.10/site-packages/uvicorn/protocols/http/httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x1051be2f0>
  File "/Users/shareai-lm/lm-codespace/server/fastapi_template/lib/python3.10/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x107753970>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x1077539...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x104c099c0>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x1051be2f0>
  File "/Users/shareai-lm/lm-codespace/server/fastapi_template/lib/python3.10/site-packages/fastapi/applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x107753970>>
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x1077539...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "/Users/shareai-lm/lm-codespace/server/fastapi_template/lib/python3.10/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x107753970>>
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x1077539...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x10771a410>
          └ <fastapi.applications.FastAPI object at 0x104c099c0>
  File "/Users/shareai-lm/lm-codespace/server/fastapi_template/lib/python3.10/site-packages/starlette/middleware/errors.py", line 187, in __call__
    raise exc
  File "/Users/shareai-lm/lm-codespace/server/fastapi_template/lib/python3.10/site-packages/starlette/middleware/errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x107766cb0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x1077539...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x10771a470>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x10771a410>
  File "/Users/shareai-lm/lm-codespace/server/fastapi_template/lib/python3.10/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
          │                            │    │    │     │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x107766cb0>
          │                            │    │    │     │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x1077539...
          │                            │    │    │     └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │                            │    │    └ <starlette.requests.Request object at 0x107753850>
          │                            │    └ <fastapi.routing.APIRouter object at 0x1064abd90>
          │                            └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x10771a470>
          └ <function wrap_app_handling_exceptions at 0x106332a70>
  File "/Users/shareai-lm/lm-codespace/server/fastapi_template/lib/python3.10/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/shareai-lm/lm-codespace/server/fastapi_template/lib/python3.10/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
          │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x107a8e320>
          │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x1077539...
          │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          └ <fastapi.routing.APIRouter object at 0x1064abd90>
  File "/Users/shareai-lm/lm-codespace/server/fastapi_template/lib/python3.10/site-packages/starlette/routing.py", line 715, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x107a8e320>
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x1077539...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <bound method Router.app of <fastapi.routing.APIRouter object at 0x1064abd90>>
          └ <fastapi.routing.APIRouter object at 0x1064abd90>
  File "/Users/shareai-lm/lm-codespace/server/fastapi_template/lib/python3.10/site-packages/starlette/routing.py", line 735, in app
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x107a8e320>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x1077539...
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x106333f40>
          └ APIRoute(path='/chat/completions', name='chat_completions', methods=['POST'])
  File "/Users/shareai-lm/lm-codespace/server/fastapi_template/lib/python3.10/site-packages/starlette/routing.py", line 288, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x107a8e320>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x1077539...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x10770c550>
          └ APIRoute(path='/chat/completions', name='chat_completions', methods=['POST'])
  File "/Users/shareai-lm/lm-codespace/server/fastapi_template/lib/python3.10/site-packages/starlette/routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
          │                            │    │        │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x107a8e320>
          │                            │    │        │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x1077539...
          │                            │    │        └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │                            │    └ <starlette.requests.Request object at 0x107753730>
          │                            └ <function request_response.<locals>.app.<locals>.app at 0x107a8e290>
          └ <function wrap_app_handling_exceptions at 0x106332a70>
  File "/Users/shareai-lm/lm-codespace/server/fastapi_template/lib/python3.10/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/shareai-lm/lm-codespace/server/fastapi_template/lib/python3.10/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
          │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x107a8e200>
          │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x1077539...
          │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          └ <function request_response.<locals>.app.<locals>.app at 0x107a8e290>
  File "/Users/shareai-lm/lm-codespace/server/fastapi_template/lib/python3.10/site-packages/starlette/routing.py", line 73, in app
    response = await f(request)
                     │ └ <starlette.requests.Request object at 0x107753730>
                     └ <function get_request_handler.<locals>.app at 0x10770c4c0>
  File "/Users/shareai-lm/lm-codespace/server/fastapi_template/lib/python3.10/site-packages/fastapi/routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x106361ab0>
  File "/Users/shareai-lm/lm-codespace/server/fastapi_template/lib/python3.10/site-packages/fastapi/routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'request': ChatRequest(messages=[], prompt='哈哈哈', system_prompt=None, model='gpt-4o-mini', stream=True, max_retries=2, retry...
                 │         └ <function chat_completions at 0x1074c2a70>
                 └ Dependant(path_params=[], query_params=[], header_params=[], cookie_params=[], body_params=[ModelField(field_info=Body(Pydant...

  File "/Users/shareai-lm/lm-codespace/server/app/controller/chat.py", line 44, in chat_completions
    raise error_response(data=None, msg=f"服务器繁忙")
          └ functools.partial(<function create_response at 0x1063f5090>, data=None)

TypeError: create_response() missing 1 required keyword-only argument: 'code'
2025-03-08 17:03:59.798 |  ERROR   | process [19384]:8598504000 | 无UUID | uvicorn.protocols.http.httptools_impl:run_asgi:414 - Exception in ASGI application

Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/Users/shareai-lm/.local/share/uv/python/cpython-3.10.16-macos-aarch64-none/lib/python3.10/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x10328e200>
  File "/Users/shareai-lm/.local/share/uv/python/cpython-3.10.16-macos-aarch64-none/lib/python3.10/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x1031a92d0>
           └ <SpawnProcess name='SpawnProcess-55' parent=7490 started>
  File "/Users/shareai-lm/.local/share/uv/python/cpython-3.10.16-macos-aarch64-none/lib/python3.10/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x1031a8940>
    └ <SpawnProcess name='SpawnProcess-55' parent=7490 started>
  File "/Users/shareai-lm/.local/share/uv/python/cpython-3.10.16-macos-aarch64-none/lib/python3.10/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x1032a9d50>, 'target': <bound method Server.run of <uvicorn.server.Server object...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-55' parent=7490 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-55' parent=7490 started>
    │    └ <function subprocess_started at 0x1037adcf0>
    └ <SpawnProcess name='SpawnProcess-55' parent=7490 started>
  File "/Users/shareai-lm/lm-codespace/server/fastapi_template/lib/python3.10/site-packages/uvicorn/_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('0.0.0.0', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x1032a9de0>>
  File "/Users/shareai-lm/lm-codespace/server/fastapi_template/lib/python3.10/site-packages/uvicorn/server.py", line 66, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('0.0.0.0', 8000)>]
           │       │   │    └ <function Server.serve at 0x1037ad090>
           │       │   └ <uvicorn.server.Server object at 0x1032a9de0>
           │       └ <function run at 0x103295480>
           └ <module 'asyncio' from '/Users/shareai-lm/.local/share/uv/python/cpython-3.10.16-macos-aarch64-none/lib/python3.10/asyncio/__...
  File "/Users/shareai-lm/.local/share/uv/python/cpython-3.10.16-macos-aarch64-none/lib/python3.10/asyncio/runners.py", line 44, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x105353b50>
           │    └ <cyfunction Loop.run_until_complete at 0x1054a86c0>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/Users/shareai-lm/lm-codespace/server/fastapi_template/lib/python3.10/site-packages/uvicorn/protocols/http/httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x1054a1d20>
  File "/Users/shareai-lm/lm-codespace/server/fastapi_template/lib/python3.10/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x120d52830>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x120d528...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x1055119c0>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x1054a1d20>
  File "/Users/shareai-lm/lm-codespace/server/fastapi_template/lib/python3.10/site-packages/fastapi/applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x120d52830>>
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x120d528...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "/Users/shareai-lm/lm-codespace/server/fastapi_template/lib/python3.10/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x120d52830>>
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x120d528...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x120d1a500>
          └ <fastapi.applications.FastAPI object at 0x1055119c0>
  File "/Users/shareai-lm/lm-codespace/server/fastapi_template/lib/python3.10/site-packages/starlette/middleware/errors.py", line 187, in __call__
    raise exc
  File "/Users/shareai-lm/lm-codespace/server/fastapi_template/lib/python3.10/site-packages/starlette/middleware/errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x120d645e0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x120d528...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x120d1a2f0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x120d1a500>
  File "/Users/shareai-lm/lm-codespace/server/fastapi_template/lib/python3.10/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
          │                            │    │    │     │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x120d645e0>
          │                            │    │    │     │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x120d528...
          │                            │    │    │     └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │                            │    │    └ <starlette.requests.Request object at 0x120d528f0>
          │                            │    └ <fastapi.routing.APIRouter object at 0x1205abd90>
          │                            └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x120d1a2f0>
          └ <function wrap_app_handling_exceptions at 0x120332a70>
  File "/Users/shareai-lm/lm-codespace/server/fastapi_template/lib/python3.10/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/shareai-lm/lm-codespace/server/fastapi_template/lib/python3.10/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
          │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x120d64550>
          │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x120d528...
          │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          └ <fastapi.routing.APIRouter object at 0x1205abd90>
  File "/Users/shareai-lm/lm-codespace/server/fastapi_template/lib/python3.10/site-packages/starlette/routing.py", line 715, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x120d64550>
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x120d528...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <bound method Router.app of <fastapi.routing.APIRouter object at 0x1205abd90>>
          └ <fastapi.routing.APIRouter object at 0x1205abd90>
  File "/Users/shareai-lm/lm-codespace/server/fastapi_template/lib/python3.10/site-packages/starlette/routing.py", line 735, in app
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x120d64550>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x120d528...
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x120333f40>
          └ APIRoute(path='/chat/completions', name='chat_completions', methods=['POST'])
  File "/Users/shareai-lm/lm-codespace/server/fastapi_template/lib/python3.10/site-packages/starlette/routing.py", line 288, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x120d64550>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x120d528...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x120d0c550>
          └ APIRoute(path='/chat/completions', name='chat_completions', methods=['POST'])
  File "/Users/shareai-lm/lm-codespace/server/fastapi_template/lib/python3.10/site-packages/starlette/routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
          │                            │    │        │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x120d64550>
          │                            │    │        │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x120d528...
          │                            │    │        └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │                            │    └ <starlette.requests.Request object at 0x120d52a70>
          │                            └ <function request_response.<locals>.app.<locals>.app at 0x120d644c0>
          └ <function wrap_app_handling_exceptions at 0x120332a70>
  File "/Users/shareai-lm/lm-codespace/server/fastapi_template/lib/python3.10/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/shareai-lm/lm-codespace/server/fastapi_template/lib/python3.10/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
          │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x120d64430>
          │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x120d528...
          │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          └ <function request_response.<locals>.app.<locals>.app at 0x120d644c0>
  File "/Users/shareai-lm/lm-codespace/server/fastapi_template/lib/python3.10/site-packages/starlette/routing.py", line 73, in app
    response = await f(request)
                     │ └ <starlette.requests.Request object at 0x120d52a70>
                     └ <function get_request_handler.<locals>.app at 0x120d0c4c0>
  File "/Users/shareai-lm/lm-codespace/server/fastapi_template/lib/python3.10/site-packages/fastapi/routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x120361ab0>
  File "/Users/shareai-lm/lm-codespace/server/fastapi_template/lib/python3.10/site-packages/fastapi/routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'request': ChatRequest(messages=[], prompt='哈哈哈', system_prompt=None, model='gpt-4o-mini', stream=True, max_retries=2, retry...
                 │         └ <function chat_completions at 0x120bc2a70>
                 └ Dependant(path_params=[], query_params=[], header_params=[], cookie_params=[], body_params=[ModelField(field_info=Body(Pydant...

  File "/Users/shareai-lm/lm-codespace/server/app/controller/chat.py", line 44, in chat_completions
    raise error_response(code=ResponseCode.INTERNAL_ERROR, data=None, msg=f"服务器繁忙")
          │                   │            └ <ResponseCode.INTERNAL_ERROR: 50000>
          │                   └ <enum 'ResponseCode'>
          └ functools.partial(<function create_response at 0x1203f5090>, data=None)

TypeError: exceptions must derive from BaseException
2025-03-08 17:04:03.801 |  ERROR   | process [19384]:8598504000 | 无UUID | uvicorn.protocols.http.httptools_impl:run_asgi:414 - Exception in ASGI application

Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/Users/shareai-lm/.local/share/uv/python/cpython-3.10.16-macos-aarch64-none/lib/python3.10/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x10328e200>
  File "/Users/shareai-lm/.local/share/uv/python/cpython-3.10.16-macos-aarch64-none/lib/python3.10/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x1031a92d0>
           └ <SpawnProcess name='SpawnProcess-55' parent=7490 started>
  File "/Users/shareai-lm/.local/share/uv/python/cpython-3.10.16-macos-aarch64-none/lib/python3.10/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x1031a8940>
    └ <SpawnProcess name='SpawnProcess-55' parent=7490 started>
  File "/Users/shareai-lm/.local/share/uv/python/cpython-3.10.16-macos-aarch64-none/lib/python3.10/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x1032a9d50>, 'target': <bound method Server.run of <uvicorn.server.Server object...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-55' parent=7490 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-55' parent=7490 started>
    │    └ <function subprocess_started at 0x1037adcf0>
    └ <SpawnProcess name='SpawnProcess-55' parent=7490 started>
  File "/Users/shareai-lm/lm-codespace/server/fastapi_template/lib/python3.10/site-packages/uvicorn/_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('0.0.0.0', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x1032a9de0>>
  File "/Users/shareai-lm/lm-codespace/server/fastapi_template/lib/python3.10/site-packages/uvicorn/server.py", line 66, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('0.0.0.0', 8000)>]
           │       │   │    └ <function Server.serve at 0x1037ad090>
           │       │   └ <uvicorn.server.Server object at 0x1032a9de0>
           │       └ <function run at 0x103295480>
           └ <module 'asyncio' from '/Users/shareai-lm/.local/share/uv/python/cpython-3.10.16-macos-aarch64-none/lib/python3.10/asyncio/__...
  File "/Users/shareai-lm/.local/share/uv/python/cpython-3.10.16-macos-aarch64-none/lib/python3.10/asyncio/runners.py", line 44, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x105353b50>
           │    └ <cyfunction Loop.run_until_complete at 0x1054a86c0>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/Users/shareai-lm/lm-codespace/server/fastapi_template/lib/python3.10/site-packages/uvicorn/protocols/http/httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x1054a1d20>
  File "/Users/shareai-lm/lm-codespace/server/fastapi_template/lib/python3.10/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x120d539d0>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x120d539...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x1055119c0>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x1054a1d20>
  File "/Users/shareai-lm/lm-codespace/server/fastapi_template/lib/python3.10/site-packages/fastapi/applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x120d539d0>>
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x120d539...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "/Users/shareai-lm/lm-codespace/server/fastapi_template/lib/python3.10/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x120d539d0>>
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x120d539...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x120d1a500>
          └ <fastapi.applications.FastAPI object at 0x1055119c0>
  File "/Users/shareai-lm/lm-codespace/server/fastapi_template/lib/python3.10/site-packages/starlette/middleware/errors.py", line 187, in __call__
    raise exc
  File "/Users/shareai-lm/lm-codespace/server/fastapi_template/lib/python3.10/site-packages/starlette/middleware/errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x120d66c20>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x120d539...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x120d1a2f0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x120d1a500>
  File "/Users/shareai-lm/lm-codespace/server/fastapi_template/lib/python3.10/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
          │                            │    │    │     │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x120d66c20>
          │                            │    │    │     │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x120d539...
          │                            │    │    │     └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │                            │    │    └ <starlette.requests.Request object at 0x120d53940>
          │                            │    └ <fastapi.routing.APIRouter object at 0x1205abd90>
          │                            └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x120d1a2f0>
          └ <function wrap_app_handling_exceptions at 0x120332a70>
  File "/Users/shareai-lm/lm-codespace/server/fastapi_template/lib/python3.10/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/shareai-lm/lm-codespace/server/fastapi_template/lib/python3.10/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
          │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x120e8e320>
          │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x120d539...
          │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          └ <fastapi.routing.APIRouter object at 0x1205abd90>
  File "/Users/shareai-lm/lm-codespace/server/fastapi_template/lib/python3.10/site-packages/starlette/routing.py", line 715, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x120e8e320>
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x120d539...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <bound method Router.app of <fastapi.routing.APIRouter object at 0x1205abd90>>
          └ <fastapi.routing.APIRouter object at 0x1205abd90>
  File "/Users/shareai-lm/lm-codespace/server/fastapi_template/lib/python3.10/site-packages/starlette/routing.py", line 735, in app
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x120e8e320>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x120d539...
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x120333f40>
          └ APIRoute(path='/chat/completions', name='chat_completions', methods=['POST'])
  File "/Users/shareai-lm/lm-codespace/server/fastapi_template/lib/python3.10/site-packages/starlette/routing.py", line 288, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x120e8e320>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x120d539...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x120d0c550>
          └ APIRoute(path='/chat/completions', name='chat_completions', methods=['POST'])
  File "/Users/shareai-lm/lm-codespace/server/fastapi_template/lib/python3.10/site-packages/starlette/routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
          │                            │    │        │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x120e8e320>
          │                            │    │        │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x120d539...
          │                            │    │        └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │                            │    └ <starlette.requests.Request object at 0x120d532b0>
          │                            └ <function request_response.<locals>.app.<locals>.app at 0x120e8e290>
          └ <function wrap_app_handling_exceptions at 0x120332a70>
  File "/Users/shareai-lm/lm-codespace/server/fastapi_template/lib/python3.10/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/shareai-lm/lm-codespace/server/fastapi_template/lib/python3.10/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
          │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x120e8e200>
          │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x120d539...
          │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          └ <function request_response.<locals>.app.<locals>.app at 0x120e8e290>
  File "/Users/shareai-lm/lm-codespace/server/fastapi_template/lib/python3.10/site-packages/starlette/routing.py", line 73, in app
    response = await f(request)
                     │ └ <starlette.requests.Request object at 0x120d532b0>
                     └ <function get_request_handler.<locals>.app at 0x120d0c4c0>
  File "/Users/shareai-lm/lm-codespace/server/fastapi_template/lib/python3.10/site-packages/fastapi/routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x120361ab0>
  File "/Users/shareai-lm/lm-codespace/server/fastapi_template/lib/python3.10/site-packages/fastapi/routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'request': ChatRequest(messages=[], prompt='哈哈哈', system_prompt=None, model='gpt-4o-mini', stream=True, max_retries=2, retry...
                 │         └ <function chat_completions at 0x120bc2a70>
                 └ Dependant(path_params=[], query_params=[], header_params=[], cookie_params=[], body_params=[ModelField(field_info=Body(Pydant...

  File "/Users/shareai-lm/lm-codespace/server/app/controller/chat.py", line 44, in chat_completions
    raise error_response(code=ResponseCode.INTERNAL_ERROR, data=None, msg=f"服务器繁忙")
          │                   │            └ <ResponseCode.INTERNAL_ERROR: 50000>
          │                   └ <enum 'ResponseCode'>
          └ functools.partial(<function create_response at 0x1203f5090>, data=None)

TypeError: exceptions must derive from BaseException
2025-03-08 17:04:15.121 |  ERROR   | process [19437]:8598504000 | 无UUID | uvicorn.protocols.http.httptools_impl:run_asgi:414 - Exception in ASGI application

Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/Users/shareai-lm/.local/share/uv/python/cpython-3.10.16-macos-aarch64-none/lib/python3.10/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x104a86200>
  File "/Users/shareai-lm/.local/share/uv/python/cpython-3.10.16-macos-aarch64-none/lib/python3.10/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x1049a12d0>
           └ <SpawnProcess name='SpawnProcess-56' parent=7490 started>
  File "/Users/shareai-lm/.local/share/uv/python/cpython-3.10.16-macos-aarch64-none/lib/python3.10/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x1049a0940>
    └ <SpawnProcess name='SpawnProcess-56' parent=7490 started>
  File "/Users/shareai-lm/.local/share/uv/python/cpython-3.10.16-macos-aarch64-none/lib/python3.10/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x104aa1d50>, 'target': <bound method Server.run of <uvicorn.server.Server object...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-56' parent=7490 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-56' parent=7490 started>
    │    └ <function subprocess_started at 0x104fa5cf0>
    └ <SpawnProcess name='SpawnProcess-56' parent=7490 started>
  File "/Users/shareai-lm/lm-codespace/server/fastapi_template/lib/python3.10/site-packages/uvicorn/_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('0.0.0.0', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x104aa1de0>>
  File "/Users/shareai-lm/lm-codespace/server/fastapi_template/lib/python3.10/site-packages/uvicorn/server.py", line 66, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('0.0.0.0', 8000)>]
           │       │   │    └ <function Server.serve at 0x104fa5090>
           │       │   └ <uvicorn.server.Server object at 0x104aa1de0>
           │       └ <function run at 0x104a8d480>
           └ <module 'asyncio' from '/Users/shareai-lm/.local/share/uv/python/cpython-3.10.16-macos-aarch64-none/lib/python3.10/asyncio/__...
  File "/Users/shareai-lm/.local/share/uv/python/cpython-3.10.16-macos-aarch64-none/lib/python3.10/asyncio/runners.py", line 44, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x105587b50>
           │    └ <cyfunction Loop.run_until_complete at 0x106c346c0>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/Users/shareai-lm/lm-codespace/server/fastapi_template/lib/python3.10/site-packages/uvicorn/protocols/http/httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x106c3e2f0>
  File "/Users/shareai-lm/lm-codespace/server/fastapi_template/lib/python3.10/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x110952740>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x1109527...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x1057459c0>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x106c3e2f0>
  File "/Users/shareai-lm/lm-codespace/server/fastapi_template/lib/python3.10/site-packages/fastapi/applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x110952740>>
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x1109527...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "/Users/shareai-lm/lm-codespace/server/fastapi_template/lib/python3.10/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x110952740>>
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x1109527...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x11091a410>
          └ <fastapi.applications.FastAPI object at 0x1057459c0>
  File "/Users/shareai-lm/lm-codespace/server/fastapi_template/lib/python3.10/site-packages/starlette/middleware/errors.py", line 187, in __call__
    raise exc
  File "/Users/shareai-lm/lm-codespace/server/fastapi_template/lib/python3.10/site-packages/starlette/middleware/errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x1109645e0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x1109527...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x11091a200>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x11091a410>
  File "/Users/shareai-lm/lm-codespace/server/fastapi_template/lib/python3.10/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
          │                            │    │    │     │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x1109645e0>
          │                            │    │    │     │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x1109527...
          │                            │    │    │     └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │                            │    │    └ <starlette.requests.Request object at 0x110952800>
          │                            │    └ <fastapi.routing.APIRouter object at 0x1101abd90>
          │                            └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x11091a200>
          └ <function wrap_app_handling_exceptions at 0x110032a70>
  File "/Users/shareai-lm/lm-codespace/server/fastapi_template/lib/python3.10/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/shareai-lm/lm-codespace/server/fastapi_template/lib/python3.10/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
          │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x110964550>
          │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x1109527...
          │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          └ <fastapi.routing.APIRouter object at 0x1101abd90>
  File "/Users/shareai-lm/lm-codespace/server/fastapi_template/lib/python3.10/site-packages/starlette/routing.py", line 715, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x110964550>
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x1109527...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <bound method Router.app of <fastapi.routing.APIRouter object at 0x1101abd90>>
          └ <fastapi.routing.APIRouter object at 0x1101abd90>
  File "/Users/shareai-lm/lm-codespace/server/fastapi_template/lib/python3.10/site-packages/starlette/routing.py", line 735, in app
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x110964550>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x1109527...
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x110033f40>
          └ APIRoute(path='/chat/completions', name='chat_completions', methods=['POST'])
  File "/Users/shareai-lm/lm-codespace/server/fastapi_template/lib/python3.10/site-packages/starlette/routing.py", line 288, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x110964550>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x1109527...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x11090c550>
          └ APIRoute(path='/chat/completions', name='chat_completions', methods=['POST'])
  File "/Users/shareai-lm/lm-codespace/server/fastapi_template/lib/python3.10/site-packages/starlette/routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
          │                            │    │        │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x110964550>
          │                            │    │        │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x1109527...
          │                            │    │        └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │                            │    └ <starlette.requests.Request object at 0x110952980>
          │                            └ <function request_response.<locals>.app.<locals>.app at 0x1109644c0>
          └ <function wrap_app_handling_exceptions at 0x110032a70>
  File "/Users/shareai-lm/lm-codespace/server/fastapi_template/lib/python3.10/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/shareai-lm/lm-codespace/server/fastapi_template/lib/python3.10/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
          │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x110964430>
          │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x1109527...
          │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          └ <function request_response.<locals>.app.<locals>.app at 0x1109644c0>
  File "/Users/shareai-lm/lm-codespace/server/fastapi_template/lib/python3.10/site-packages/starlette/routing.py", line 73, in app
    response = await f(request)
                     │ └ <starlette.requests.Request object at 0x110952980>
                     └ <function get_request_handler.<locals>.app at 0x11090c4c0>
  File "/Users/shareai-lm/lm-codespace/server/fastapi_template/lib/python3.10/site-packages/fastapi/routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x110061ab0>
  File "/Users/shareai-lm/lm-codespace/server/fastapi_template/lib/python3.10/site-packages/fastapi/routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'request': ChatRequest(messages=[], prompt='哈哈哈', system_prompt=None, model='gpt-4o-mini', stream=True, max_retries=2, retry...
                 │         └ <function chat_completions at 0x1107c2a70>
                 └ Dependant(path_params=[], query_params=[], header_params=[], cookie_params=[], body_params=[ModelField(field_info=Body(Pydant...

  File "/Users/shareai-lm/lm-codespace/server/app/controller/chat.py", line 44, in chat_completions
    raise error_response(code=ResponseCode.INTERNAL_ERROR, data=None, msg="服务器繁忙")
          │                   │            └ <ResponseCode.INTERNAL_ERROR: 50000>
          │                   └ <enum 'ResponseCode'>
          └ functools.partial(<function create_response at 0x1100f5090>, data=None)

TypeError: exceptions must derive from BaseException
2025-03-08 17:04:22.819 |  ERROR   | process [19464]:8598504000 | 无UUID | uvicorn.protocols.http.httptools_impl:run_asgi:414 - Exception in ASGI application

Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/Users/shareai-lm/.local/share/uv/python/cpython-3.10.16-macos-aarch64-none/lib/python3.10/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x1033f2200>
  File "/Users/shareai-lm/.local/share/uv/python/cpython-3.10.16-macos-aarch64-none/lib/python3.10/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x10330d2d0>
           └ <SpawnProcess name='SpawnProcess-57' parent=7490 started>
  File "/Users/shareai-lm/.local/share/uv/python/cpython-3.10.16-macos-aarch64-none/lib/python3.10/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x10330c940>
    └ <SpawnProcess name='SpawnProcess-57' parent=7490 started>
  File "/Users/shareai-lm/.local/share/uv/python/cpython-3.10.16-macos-aarch64-none/lib/python3.10/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x10340dd50>, 'target': <bound method Server.run of <uvicorn.server.Server object...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-57' parent=7490 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-57' parent=7490 started>
    │    └ <function subprocess_started at 0x103911cf0>
    └ <SpawnProcess name='SpawnProcess-57' parent=7490 started>
  File "/Users/shareai-lm/lm-codespace/server/fastapi_template/lib/python3.10/site-packages/uvicorn/_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('0.0.0.0', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x10340dde0>>
  File "/Users/shareai-lm/lm-codespace/server/fastapi_template/lib/python3.10/site-packages/uvicorn/server.py", line 66, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('0.0.0.0', 8000)>]
           │       │   │    └ <function Server.serve at 0x103911090>
           │       │   └ <uvicorn.server.Server object at 0x10340dde0>
           │       └ <function run at 0x1033f9480>
           └ <module 'asyncio' from '/Users/shareai-lm/.local/share/uv/python/cpython-3.10.16-macos-aarch64-none/lib/python3.10/asyncio/__...
  File "/Users/shareai-lm/.local/share/uv/python/cpython-3.10.16-macos-aarch64-none/lib/python3.10/asyncio/runners.py", line 44, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x103ef3b50>
           │    └ <cyfunction Loop.run_until_complete at 0x1051cc6c0>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/Users/shareai-lm/lm-codespace/server/fastapi_template/lib/python3.10/site-packages/uvicorn/protocols/http/httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x1051d62f0>
  File "/Users/shareai-lm/lm-codespace/server/fastapi_template/lib/python3.10/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x1065267d0>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x1065267...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x1050c99c0>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x1051d62f0>
  File "/Users/shareai-lm/lm-codespace/server/fastapi_template/lib/python3.10/site-packages/fastapi/applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x1065267d0>>
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x1065267...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "/Users/shareai-lm/lm-codespace/server/fastapi_template/lib/python3.10/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x1065267d0>>
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x1065267...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x1064ee4a0>
          └ <fastapi.applications.FastAPI object at 0x1050c99c0>
  File "/Users/shareai-lm/lm-codespace/server/fastapi_template/lib/python3.10/site-packages/starlette/middleware/errors.py", line 187, in __call__
    raise exc
  File "/Users/shareai-lm/lm-codespace/server/fastapi_template/lib/python3.10/site-packages/starlette/middleware/errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x1065385e0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x1065267...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x1064ee290>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x1064ee4a0>
  File "/Users/shareai-lm/lm-codespace/server/fastapi_template/lib/python3.10/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
          │                            │    │    │     │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x1065385e0>
          │                            │    │    │     │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x1065267...
          │                            │    │    │     └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │                            │    │    └ <starlette.requests.Request object at 0x106526890>
          │                            │    └ <fastapi.routing.APIRouter object at 0x105e7fd90>
          │                            └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x1064ee290>
          └ <function wrap_app_handling_exceptions at 0x105d06a70>
  File "/Users/shareai-lm/lm-codespace/server/fastapi_template/lib/python3.10/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/shareai-lm/lm-codespace/server/fastapi_template/lib/python3.10/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
          │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x106538550>
          │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x1065267...
          │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          └ <fastapi.routing.APIRouter object at 0x105e7fd90>
  File "/Users/shareai-lm/lm-codespace/server/fastapi_template/lib/python3.10/site-packages/starlette/routing.py", line 715, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x106538550>
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x1065267...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <bound method Router.app of <fastapi.routing.APIRouter object at 0x105e7fd90>>
          └ <fastapi.routing.APIRouter object at 0x105e7fd90>
  File "/Users/shareai-lm/lm-codespace/server/fastapi_template/lib/python3.10/site-packages/starlette/routing.py", line 735, in app
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x106538550>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x1065267...
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x105d07f40>
          └ APIRoute(path='/chat/completions', name='chat_completions', methods=['POST'])
  File "/Users/shareai-lm/lm-codespace/server/fastapi_template/lib/python3.10/site-packages/starlette/routing.py", line 288, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x106538550>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x1065267...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x1064e0550>
          └ APIRoute(path='/chat/completions', name='chat_completions', methods=['POST'])
  File "/Users/shareai-lm/lm-codespace/server/fastapi_template/lib/python3.10/site-packages/starlette/routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
          │                            │    │        │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x106538550>
          │                            │    │        │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x1065267...
          │                            │    │        └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │                            │    └ <starlette.requests.Request object at 0x106526a10>
          │                            └ <function request_response.<locals>.app.<locals>.app at 0x1065384c0>
          └ <function wrap_app_handling_exceptions at 0x105d06a70>
  File "/Users/shareai-lm/lm-codespace/server/fastapi_template/lib/python3.10/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/shareai-lm/lm-codespace/server/fastapi_template/lib/python3.10/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
          │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x106538430>
          │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x1065267...
          │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          └ <function request_response.<locals>.app.<locals>.app at 0x1065384c0>
  File "/Users/shareai-lm/lm-codespace/server/fastapi_template/lib/python3.10/site-packages/starlette/routing.py", line 73, in app
    response = await f(request)
                     │ └ <starlette.requests.Request object at 0x106526a10>
                     └ <function get_request_handler.<locals>.app at 0x1064e04c0>
  File "/Users/shareai-lm/lm-codespace/server/fastapi_template/lib/python3.10/site-packages/fastapi/routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x105d35ab0>
  File "/Users/shareai-lm/lm-codespace/server/fastapi_template/lib/python3.10/site-packages/fastapi/routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'request': ChatRequest(messages=[], prompt='哈哈哈', system_prompt=None, model='gpt-4o-mini', stream=True, max_retries=2, retry...
                 │         └ <function chat_completions at 0x106496a70>
                 └ Dependant(path_params=[], query_params=[], header_params=[], cookie_params=[], body_params=[ModelField(field_info=Body(Pydant...

  File "/Users/shareai-lm/lm-codespace/server/app/controller/chat.py", line 44, in chat_completions
    raise error_response(code=ResponseCode.INTERNAL_ERROR, data=None)
          │                   │            └ <ResponseCode.INTERNAL_ERROR: 50000>
          │                   └ <enum 'ResponseCode'>
          └ functools.partial(<function create_response at 0x105dc9090>, data=None)

TypeError: exceptions must derive from BaseException
